import{j as e}from"./index-a4776ee8.js";import{r as c}from"./vendor-e182443c.js";import{Y as E,X as U,a as G,t as T,U as z,e as V,l as P,af as Y,F as q,D as X}from"./ui-9fedfdd7.js";import"./auth-c67ad916.js";const W=({isOpen:$,onClose:u,allUsers:p=[],teamRelationships:b=[]})=>{const[i,y]=c.useState({startDate:new Date(Date.now()-2592e6).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]}),[n,A]=c.useState({meetings:!0,dreamsCreated:!0,dreamsCompleted:!0,tasksCreated:!0,tasksCompleted:!0,userEngagement:!0,teamPerformance:!0}),[m,j]=c.useState(["all"]),[h,N]=c.useState(["all"]),[g,v]=c.useState("csv"),[C,w]=c.useState(!1),I=[...new Set(p.map(t=>t.office))],O=b.map(t=>({id:t.managerId,name:t.teamName})),R=()=>{const t=new Date(i.startDate),a=new Date(i.endDate),r=Math.ceil((a-t)/(1e3*60*60*24));return p.map(s=>{const l=b.find(f=>f.teamMembers.includes(s.id));if(m[0]!=="all"&&!m.includes(s.office)||h[0]!=="all"&&l&&!h.includes(l.managerId))return null;const o=Math.max(0,s.score/10);return{userId:s.id,name:s.name,email:s.email,office:s.office,team:l?.teamName||"No Team",coach:l?p.find(f=>f.id===l.managerId)?.name:"No Coach",meetingsAttended:Math.floor(Math.random()*8)+Math.floor(o/2),meetingsScheduled:Math.floor(Math.random()*5)+Math.floor(o/3),dreamsCreated:Math.floor(Math.random()*3)+(s.dreamBook?.length>5?1:0),dreamsCompleted:Math.floor(Math.random()*2)+Math.floor(o/8),dreamsInProgress:s.dreamBook?.length||Math.floor(Math.random()*5),tasksCreated:Math.floor(Math.random()*15)+Math.floor(o),tasksCompleted:Math.floor(Math.random()*12)+Math.floor(o*.8),loginDays:Math.min(r,Math.floor(Math.random()*r)+Math.floor(o/2)),averageSessionMinutes:Math.floor(Math.random()*45)+15,connectsInitiated:s.connects?.length||Math.floor(Math.random()*3),scorecardPoints:s.score,engagementScore:Math.min(100,Math.floor(o*8)+Math.floor(Math.random()*20)),lastActivity:new Date(Date.now()-Math.random()*r*24*60*60*1e3).toISOString().split("T")[0]}}).filter(Boolean)},d=c.useMemo(()=>R(),[i,m,h]),F=t=>{A(a=>({...a,[t]:!a[t]}))},k=t=>{j(t==="all"?["all"]:a=>{const r=a.filter(s=>s!=="all");if(r.includes(t)){const s=r.filter(l=>l!==t);return s.length===0?["all"]:s}else return[...r,t]})},D=t=>{N(t==="all"?["all"]:a=>{const r=a.filter(s=>s!=="all");if(r.includes(t)){const s=r.filter(l=>l!==t);return s.length===0?["all"]:s}else return[...r,t]})},M=()=>{const t=[],a=[];return t.push("Name","Email","Office","Team","Coach"),n.meetings&&t.push("Meetings Attended","Meetings Scheduled"),n.dreamsCreated&&t.push("Dreams Created","Dreams In Progress"),n.dreamsCompleted&&t.push("Dreams Completed"),n.tasksCreated&&t.push("Tasks Created"),n.tasksCompleted&&t.push("Tasks Completed"),n.userEngagement&&t.push("Login Days","Avg Session (min)","Connects Initiated","Last Activity"),n.teamPerformance&&t.push("Scorecard Points","Engagement Score"),d.forEach(s=>{const l=[s.name,s.email,s.office,s.team,s.coach];n.meetings&&l.push(s.meetingsAttended,s.meetingsScheduled),n.dreamsCreated&&l.push(s.dreamsCreated,s.dreamsInProgress),n.dreamsCompleted&&l.push(s.dreamsCompleted),n.tasksCreated&&l.push(s.tasksCreated),n.tasksCompleted&&l.push(s.tasksCompleted),n.userEngagement&&l.push(s.loginDays,s.averageSessionMinutes,s.connectsInitiated,s.lastActivity),n.teamPerformance&&l.push(s.scorecardPoints,s.engagementScore),a.push(l)}),[t,...a].map(s=>s.map(l=>`"${l}"`).join(",")).join(`
`)},B=async()=>`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Dreams Program Engagement Report</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .header { text-align: center; margin-bottom: 30px; }
            .summary { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
            .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
            .metric-card { background: white; border: 1px solid #ddd; padding: 15px; border-radius: 8px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; }
            th { background-color: #f2f2f2; }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>Dreams Program Engagement Report</h1>
            <p>Period: ${i.startDate} to ${i.endDate}</p>
            <p>Generated: ${new Date().toLocaleDateString()}</p>
          </div>
          
          <div class="summary">
            <h2>Executive Summary</h2>
            <div class="metrics">
              <div class="metric-card">
                <h3>Total Users</h3>
                <p>${d.length}</p>
              </div>
              <div class="metric-card">
                <h3>Avg Engagement Score</h3>
                <p>${Math.round(d.reduce((a,r)=>a+r.engagementScore,0)/d.length)}%</p>
              </div>
              <div class="metric-card">
                <h3>Total Dreams Created</h3>
                <p>${d.reduce((a,r)=>a+r.dreamsCreated,0)}</p>
              </div>
              <div class="metric-card">
                <h3>Total Tasks Completed</h3>
                <p>${d.reduce((a,r)=>a+r.tasksCompleted,0)}</p>
              </div>
            </div>
          </div>

          <table>
            <thead>
              <tr>
                ${M().split(`
`)[0].split(",").map(a=>`<th>${a.replace(/"/g,"")}</th>`).join("")}
              </tr>
            </thead>
            <tbody>
              ${d.map(a=>{const r=[a.name,a.email,a.office,a.team,a.coach];return n.meetings&&r.push(a.meetingsAttended,a.meetingsScheduled),n.dreamsCreated&&r.push(a.dreamsCreated,a.dreamsInProgress),n.dreamsCompleted&&r.push(a.dreamsCompleted),n.tasksCreated&&r.push(a.tasksCreated),n.tasksCompleted&&r.push(a.tasksCompleted),n.userEngagement&&r.push(a.loginDays,a.averageSessionMinutes,a.connectsInitiated,a.lastActivity),n.teamPerformance&&r.push(a.scorecardPoints,a.engagementScore),`<tr>${r.map(s=>`<td>${s}</td>`).join("")}</tr>`}).join("")}
            </tbody>
          </table>
        </body>
      </html>
    `,L=async()=>{w(!0);try{let t,a,r;g==="csv"?(t=M(),a=`dreams-engagement-report-${i.startDate}-to-${i.endDate}.csv`,r="text/csv"):(t=await B(),a=`dreams-engagement-report-${i.startDate}-to-${i.endDate}.html`,r="text/html");const s=new Blob([t],{type:r}),l=window.URL.createObjectURL(s),o=document.createElement("a");o.href=l,o.download=a,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(l)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{w(!1)}},x=Object.values(n).filter(Boolean).length,S=d.slice(0,3);return $?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-professional-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(E,{className:"w-6 h-6 text-netsurit-red"}),e.jsx("h2",{className:"text-2xl font-bold text-professional-gray-900",children:"Report Builder"})]}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-professional-gray-100 rounded-lg transition-colors",children:e.jsx(U,{className:"w-5 h-5 text-professional-gray-500"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-140px)]",children:e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-professional-gray-900 mb-4 flex items-center",children:[e.jsx(G,{className:"w-5 h-5 mr-2 text-netsurit-red"}),"Date Range"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-professional-gray-700 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:i.startDate,onChange:t=>y(a=>({...a,startDate:t.target.value})),className:"w-full px-3 py-2 border border-professional-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-netsurit-red focus:border-netsurit-red"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-professional-gray-700 mb-2",children:"End Date"}),e.jsx("input",{type:"date",value:i.endDate,onChange:t=>y(a=>({...a,endDate:t.target.value})),className:"w-full px-3 py-2 border border-professional-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-netsurit-red focus:border-netsurit-red"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-professional-gray-900 mb-4 flex items-center",children:[e.jsx(T,{className:"w-5 h-5 mr-2 text-netsurit-coral"}),"Metrics to Include (",x," selected)"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[{key:"meetings",label:"Meeting Attendance",icon:z,desc:"Meetings attended and scheduled"},{key:"dreamsCreated",label:"Dreams Created",icon:V,desc:"New dreams added to dream books"},{key:"dreamsCompleted",label:"Dreams Completed",icon:P,desc:"Dreams marked as completed"},{key:"tasksCreated",label:"Tasks Created",icon:Y,desc:"New tasks and goals created"},{key:"tasksCompleted",label:"Tasks Completed",icon:P,desc:"Tasks and goals completed"},{key:"userEngagement",label:"User Engagement",icon:T,desc:"Login frequency, session time, connects"},{key:"teamPerformance",label:"Team Performance",icon:E,desc:"Scorecard points and engagement scores"}].map(({key:t,label:a,icon:r,desc:s})=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("input",{type:"checkbox",id:t,checked:n[t],onChange:()=>F(t),className:"mt-1 h-4 w-4 text-netsurit-red focus:ring-netsurit-red border-professional-gray-300 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:t,className:"flex items-center text-sm font-medium text-professional-gray-900 cursor-pointer",children:[e.jsx(r,{className:"w-4 h-4 mr-2 text-professional-gray-600"}),a]}),e.jsx("p",{className:"text-xs text-professional-gray-600 mt-1",children:s})]})]},t))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(q,{className:"w-5 h-5 mr-2 text-indigo-600"}),"Filters"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Offices"}),e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.includes("all"),onChange:()=>k("all"),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:"All Offices"})]}),I.map(t=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.includes(t),onChange:()=>k(t),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:t})]},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Teams"}),e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:h.includes("all"),onChange:()=>D("all"),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:"All Teams"})]}),O.map(t=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:h.includes(t.id),onChange:()=>D(t.id),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:t.name})]},t.id))]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Export Format"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"exportFormat",value:"csv",checked:g==="csv",onChange:t=>v(t.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:"CSV (Excel compatible)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"exportFormat",value:"pdf",checked:g==="pdf",onChange:t=>v(t.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:"PDF Report"})]})]})]}),S.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Preview"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Report will include ",d.length," users with ",x," metric categories"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-900",children:"Name"}),e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-900",children:"Office"}),n.meetings&&e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-900",children:"Meetings"}),n.dreamsCreated&&e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-900",children:"Dreams"}),n.userEngagement&&e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-900",children:"Engagement"})]})}),e.jsx("tbody",{children:S.map((t,a)=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"py-2 px-3 text-gray-900",children:t.name}),e.jsx("td",{className:"py-2 px-3 text-gray-600",children:t.office}),n.meetings&&e.jsx("td",{className:"py-2 px-3 text-gray-600",children:t.meetingsAttended}),n.dreamsCreated&&e.jsx("td",{className:"py-2 px-3 text-gray-600",children:t.dreamsCreated}),n.userEngagement&&e.jsxs("td",{className:"py-2 px-3 text-gray-600",children:[t.engagementScore,"%"]})]},a))})]})}),d.length>3&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["... and ",d.length-3," more users"]})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-professional-gray-200 bg-professional-gray-50",children:[e.jsxs("div",{className:"text-sm text-professional-gray-600",children:[d.length," users • ",x," metrics • ",g.toUpperCase()," format"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 text-professional-gray-700 bg-white border border-professional-gray-300 rounded-lg hover:bg-professional-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:L,disabled:C||x===0,className:"flex items-center space-x-2 px-6 py-2 bg-netsurit-red text-white rounded-lg hover:bg-netsurit-coral disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm hover:shadow-md",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:C?"Generating...":"Export Report"})]})]})]})]})}):null};export{W as default};
